# -*- coding: utf-8 -*-
"""Sampled v/s Full Crime Dataset.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/11V_4A_w9sRFRfbLzqO0YYToTvSaYTVc8

# **UK Police Crime Dataset Jan 2025 - Sept 2025 : Comparision of Full Dataset v/s Sampled Dataset**

---

**Name :** Shikha Tyagi

***MSc Business Analytics***

**Student ID:** 20052009

**Dissertation Topic:** Crime Hotspot Detection Using Geospatial
Visualisation and Unsupervised Clustering : A*n Unsupervised Learning Approach on UK Open Crime Data*

**Dataset link:**

https://drive.google.com/file/d/19jYzIRPTZZuTnKMTHIJFDNHuqv_4JNEu/view?usp=drive_link
"""

# importing library
import pandas as pd

# Load full cleaned dataset
df = pd.read_csv("/content/Cleaned_crime_data.csv")   # loading the cleaned dataset

# Create 50,000 sample
sample = df.sample(n=50000, random_state=42)

# Save sample for reference
sample.to_csv("Sample_50K.csv", index=False)

# Compare Distributions Numerically (crime_type, month, outcome)
def compare_distribution(df, sample, column):
    full_dist = df[column].value_counts(normalize=True) * 100
    sample_dist = sample[column].value_counts(normalize=True) * 100

    comp = pd.concat([full_dist, sample_dist], axis=1)
    comp.columns = ['Full (%)', 'Sample (%)']
    comp['Difference (%)'] = comp['Sample (%)'] - comp['Full (%)']
    return comp.fillna(0).sort_values("Full (%)", ascending=False)

# Compare major fields
print(compare_distribution(df, sample, "crime type"))
print(compare_distribution(df, sample, "month"))
print(compare_distribution(df, sample, "last outcome category"))

"""***Statistical Test: Chi-Square***"""

from scipy.stats import chisquare

def chi_square_test(df_full, df_sample, column):
    full_counts = df_full[column].value_counts()
    sample_counts = df_sample[column].value_counts().reindex(full_counts.index, fill_value=0)
    return chisquare(f_obs=sample_counts, f_exp=(full_counts/len(df_full))*len(df_sample))

print(chi_square_test(df, sample, "crime type"))
print(chi_square_test(df, sample, "last outcome category"))

"""***Visual Evidence: Side-by-Side Bar Chart***"""

import matplotlib.pyplot as plt

def plot_distribution(full, sample, column):
    full_dist = full[column].value_counts(normalize=True).sort_index()
    sample_dist = sample[column].value_counts(normalize=True).reindex(full_dist.index, fill_value=0)

    plt.figure(figsize=(12,5))
    plt.bar(full_dist.index, full_dist.values, alpha=0.6, label='Full Dataset')
    plt.bar(sample_dist.index, sample_dist.values, alpha=0.6, label='Sample (50K)')
    plt.xticks(rotation=90)
    plt.ylabel("Proportion")
    plt.title(f"Distribution Comparison: {column}")
    plt.legend()
    plt.tight_layout()
    plt.show()

plot_distribution(df, sample, "crime type")
plot_distribution(df, sample, "last outcome category")
plot_distribution(df, sample, "month")

"""***Compare Crime Counts by Location***"""

import pandas as pd

# Load full and sample data
df_full = pd.read_csv("/content/Cleaned_crime_data.csv")
df_sample = df_full.sample(n=50000, random_state=42)

# Using LSOA
# Count crimes per LSOA
full_lsoa = df_full["lsoa name"].value_counts()
sample_lsoa = df_sample["lsoa name"].value_counts()

# Combine into a comparison table
location_compare = pd.concat([full_lsoa, sample_lsoa], axis=1)
location_compare.columns = ["Full Count", "Sample Count"]

# Normalize to compare proportionally
location_compare["Full (%)"] = location_compare["Full Count"] / location_compare["Full Count"].sum() * 100
location_compare["Sample (%)"] = location_compare["Sample Count"] / location_compare["Sample Count"].sum() * 100
location_compare["Difference (%)"] = location_compare["Sample (%)"] - location_compare["Full (%)"]

location_compare.head(20)


# Using Geographic Coordinates

df_full["latlon"] = df_full["latitude"].round(3).astype(str) + "_" + df_full["longitude"].round(3).astype(str)
df_sample["latlon"] = df_sample["latitude"].round(3).astype(str) + "_" + df_sample["longitude"].round(3).astype(str)

full_geo = df_full["latlon"].value_counts()
sample_geo = df_sample["latlon"].value_counts()

location_geo_compare = pd.concat([full_geo, sample_geo], axis=1).fillna(0)
location_geo_compare.columns = ["Full Count", "Sample Count"]

location_geo_compare["Full (%)"] = location_geo_compare["Full Count"] / location_geo_compare["Full Count"].sum() * 100
location_geo_compare["Sample (%)"] = location_geo_compare["Sample Count"] / location_geo_compare["Sample Count"].sum() * 100
location_geo_compare["Difference (%)"] = location_geo_compare["Sample (%)"] - location_geo_compare["Full (%)"]

location_geo_compare.head(20)

"""***Compare Locations***"""

import matplotlib.pyplot as plt

top10_full = full_lsoa.head(10)
top10_sample = sample_lsoa.reindex(top10_full.index, fill_value=0)

plt.figure(figsize=(12,5))
plt.bar(top10_full.index, top10_full.values, alpha=0.6, label='Full Dataset')
plt.bar(top10_sample.index, top10_sample.values, alpha=0.6, label='Sample Dataset')
plt.xticks(rotation=90)
plt.ylabel("Crime Count")
plt.title("Comparison of Crime Volume Across Top 10 LSOAs")
plt.legend()
plt.tight_layout()
plt.show()